{% extends "base.html" %}

{% block title %}{{ component.product_number }} - Component Details{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/component-detail.css') }}">
{% endblock %}

{% block content %}
<div x-data="componentDetail()" class="fade-in">
    {% include 'sections/component_header.html' %}

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            {% include 'sections/variant_gallery.html' %}

            {% include 'sections/status_workflow.html' %}

            {% include 'sections/component_info_tabs.html' %}
        </div>

        {% include 'sections/sidebar_actions.html' %}
    </div>

    {% include 'sections/lightbox_modal.html' %}
    {% include 'sections/delete_modal.html' %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/components/component-detail-manager.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/alpine-component-detail.js') }}"></script>
<script src="{{ url_for('static', filename='js/pages/component_detail.js') }}"></script>
<script>
    // Initialize Alpine component with server data
    document.addEventListener('alpine:init', () => {
        Alpine.data('componentDetail', () => {
            const instance = componentDetail();
            
            // Populate with server data
            instance.componentImages = [
                {% for picture in component.pictures|sort(attribute='picture_order') %}
                    {
                        id: {{ picture.id }},
                        name: '{{ picture.picture_name }}',
                        url: '{{ picture.url }}',
                        order: {{ picture.picture_order }}
                    }{% if not loop.last %},{% endif %}
                {% endfor %}
            ];
            
            instance.variants = [
                {% for variant in component.variants %}
                    {
                        id: {{ variant.id }},
                        name: '{{ variant.get_color_display_name() }}',
                        colorName: '{{ variant.color.name }}',
                        colorHex: '{{ variant.color.hex_code or "#ccc" }}',
                        sku: '{{ variant.variant_sku or "" }}',
                        images: [
                            {% for picture in variant.variant_pictures|sort(attribute='picture_order') %}
                                {
                                    id: {{ picture.id }},
                                    name: '{{ picture.picture_name }}',
                                    url: '{{ picture.url }}',
                                    order: {{ picture.picture_order }},
                                    altText: '{{ picture.alt_text or "" }}'
                                }{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ]
                    }{% if not loop.last %},{% endif %}
                {% endfor %}
            ];
            
            return instance;
        });
    });

    // Initialize icons after page load
    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
    });
</script>
{% endblock %}